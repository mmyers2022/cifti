---
title: "Test Cifti Original Package"
author: "myc"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Test Cifti Original Package}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

## Package

* *This vingette install and loads the `cifti` package that was on github/muschellij2/cifti as of 2/7/2019* 
* It may not reproduce the error if the version has been updated. 
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
devtools::install_github("muschellij2/cifti")
library(cifti)

download_cifti_data(outdir = "../inst/")

mscfile <- "../inst/msc/sub-MSC01_ses-func01_task-rest_bold_32k_fsLR.dtseries.nii"
if(!file.exists(mscfile)){
download.file(url = "https://openneuro.org/crn/datasets/ds000224/snapshots/00002/files/derivatives:surface_pipeline:sub-MSC01:processed_restingstate_timecourses:ses-func01:cifti:sub-MSC01_ses-func01_task-rest_bold_32k_fsLR.dtseries.nii", destfile = mscfile)
}

ds <- read_cifti("../inst/cifti-2_test_data/Conte69.MyelinAndCorrThickness.32k_fs_LR.dscalar.nii")
dt <- read_cifti("../inst/cifti-2_test_data/Conte69.MyelinAndCorrThickness.32k_fs_LR.dtseries.nii")
pt <- read_cifti("../inst/cifti-2_test_data/Conte69.MyelinAndCorrThickness.32k_fs_LR.ptseries.nii")
dl <- read_cifti("../inst/cifti-2_test_data/Conte69.parcellations_VGD11b.32k_fs_LR.dlabel.nii")
msc <- read_cifti(mscfile)
msc_trans_false <- read_cifti(mscfile, trans_data = FALSE)
```

# Load MSC data and test data from cifti package 

## Issue: data with dense data in the first dim is not load in correctly. 

* Standard cifti for dtseries is setup assuming it is row by dense. But some data available to the public is setup differently 
* e.g., Midnight Scanning Club cifti have dtseries that have dense x column (vertices as rows). 
* Those data were read in incorrectly by original `cifti_data()`

## For reference: MSC 01 (65890 * 818) (using matlab ft_read_cifti), showing first 5 rows & columns
```{r, echo=F}
msc01_refmat <- as.matrix(read.table("../inst/msc/msc01_10by10.txt", sep=","))
print(msc01_refmat[1:5,1:5])
```

## MSC Sub-01 Session 1 (sub-MSC01_ses-func01_task-rest_bold_32k_fsLR.dtseries.nii)

* header dimension shows 65890 * 818
* read in file shows 818 * 65890, with data in wrong indices.

```{r}
msc$hdr
dim(msc$data)

msc$data[1:5,1:5]
```

### Turning tansposing off (trans_data=FALSE) does not fix the problem
`msc_trans_false <- read_cifti(fname = mscfile, trans_data = FALSE)`

```{r}
# Header is the same for msc01 data with transpose option set to FALSE
msc_trans_false$hdr

# dimension of looks correct 
dim(msc_trans_false$data)

# But the data was filled incorreclty when filling the array
msc_trans_false$data[1:5,1:5]
```


## Data where dimensions are row x dense loads fine. 
### Conte69.MyelinAndCorrThickness.32k_fs_LR.dscalar.nii

* Dense file "d", vertex level data
* Header shows dimension as rows * dense
```{r}
ds$hdr
attributes(ds$BrainModel[[1]])
attributes(ds$BrainModel[[2]])
dim(ds$data)
head(ds$data)

```

### Conte69.MyelinAndCorrThickness.32k_fs_LR.dtseries.nii
```{r}
dt$hdr
attributes(dt$BrainModel[[1]])
attributes(dt$BrainModel[[2]])
dim(dt$data)
head(dt$data)

```

### Conte69.MyelinAndCorrThickness.32k_fs_LR.ptseries.nii 

* parcel level
```{r}
pt$hdr
dim(pt$data)
head(pt$data)

```


### Conte69.parcellations_VGD11b.32k_fs_LR.dlabel.nii (dense label on vertex level)

* dense label
```{r}
dl$hdr
dim(dl$data)
head(dl$data)

```

